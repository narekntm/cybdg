<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>User Management – Cypress Sandbox</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <style>:root {
      --primary: #4a90e2;
      --danger: #e94e77;
      --bg-light: #f5f7fa;
      --bg-section: #ffffff;
      --border-color: #ccc;
      --text-color: #333;
      --radius: 6px;
      --shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", sans-serif;
      background-color: var(--bg-light);
      color: var(--text-color);
      margin: 0;
      padding: 1rem 2vw;
      line-height: 1.5;
    }

    h1 {
      font-size: 1.6rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    h2 {
      font-size: 1.2rem;
      margin-bottom: 0.6rem;
      color: var(--primary);
    }

    section {
      background-color: var(--bg-section);
      padding: 1rem 1.2rem;
      border-radius: var(--radius);
      margin-bottom: 1rem;
      box-shadow: var(--shadow);
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem 1rem;
    }

    form > div {
      display: flex;
      flex-direction: column;
    }

    form .full-width {
      grid-column: 1 / -1;
    }

    .form-group-inline {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    label {
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }

    input,
    select {
      padding: 0.4rem 0.5rem;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      width: 100%;
    }

    input[type="checkbox"],
    input[type="radio"] {
      margin-right: 0.4rem;
    }

    button {
      padding: 0.5rem 0.8rem;
      border: none;
      border-radius: var(--radius);
      font-size: 0.9rem;
      cursor: pointer;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-secondary {
      background-color: #777;
      color: white;
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th,
    td {
      border: 1px solid var(--border-color);
      padding: 0.6rem;
      text-align: center;
    }

    th {
      background-color: var(--primary);
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f0f4f8;
    }

    #form-errors,
    #admin-delete-error {
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .modal {
      display: none;
      position: fixed;
      background: rgba(0, 0, 0, 0.5);
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      padding: 1.2rem;
      border-radius: 6px;
      width: 90%;
      max-width: 300px;
    }

    .error-input {
      border: 1px solid red;
      background-color: #ffe5e5;
    }

    @media (max-width: 600px) {
      table,
      thead,
      tbody,
      th,
      td,
      tr {
        display: block;
      }

      td {
        border: none;
        border-bottom: 1px solid #ccc;
        position: relative;
        padding-left: 50%;
      }

      td:before {
        position: absolute;
        left: 1rem;
        top: 0.6rem;
        white-space: nowrap;
        font-weight: bold;
      }

      tr td:nth-of-type(1):before {
        content: "Name";
      }

      tr td:nth-of-type(2):before {
        content: "Role";
      }

      tr td:nth-of-type(3):before {
        content: "Age";
      }

      tr td:nth-of-type(4):before {
        content: "Email";
      }

      tr td:nth-of-type(5):before {
        content: "Gender";
      }

      tr td:nth-of-type(6):before {
        content: "Subscription";
      }

      tr td:nth-of-type(7):before {
        content: "Status";
      }

      tr td:nth-of-type(8):before {
        content: "Actions";
      }
    }
    </style>
  </head>
  <body>
    <h1>User Management – Cypress Sandbox</h1>
    <section>
      <h2>Login as Admin</h2>
      <div id="admin-controls" style="display: none; margin-bottom: 1rem">
        <strong>You are logged in as admin.</strong>
        <button class="btn-secondary" id="logout-btn" style="margin-left: 1rem">Logout</button>
      </div>
      <form id="admin-login-form" novalidate>
        <div>
          <label for="admin-email">Email</label>
          <input id="admin-email" required type="email" />
        </div>
        <div>
          <label for="admin-password">Password</label>
          <input id="admin-password" required type="password" />
        </div>
        <div class="full-width">
          <button class="btn-primary" type="submit">Login</button>
        </div>
        <div class="full-width" id="login-status" style="color: red; display: none">Invalid credentials</div>
      </form>
    </section>

    <section>
      <h2 id="form-title">Add New User</h2>
      <form id="user-form" novalidate>
        <div class="full-width" id="form-errors" style="color: red; display: none"></div>
        <div><label for="name">Full Name</label><input id="name" required type="text" /></div>
        <div>
          <label for="role">Role</label>
          <select id="role" required>
            <option value="">Select</option>
            <option value="Admin">Admin</option>
            <option value="Editor">Editor</option>
            <option value="Viewer">Viewer</option>
          </select>
        </div>
        <div><label for="age">Age</label><input id="age" min="0" required type="number" /></div>
        <div><label for="email">Email</label><input id="email" required type="email" /></div>
        <div class="full-width">
          <label id="Gender">Gender</label>
          <div class="form-group-inline">
            <label><input name="gender" required type="radio" value="Male" /> Male</label>
            <label><input name="gender" type="radio" value="Female" /> Female</label>
            <label><input name="gender" type="radio" value="Other" /> Other</label>
          </div>
        </div>
        <div class="full-width">
          <label id="Subscribe">Subscribe to</label>
          <div class="form-group-inline">
            <label><input name="subscribe" type="checkbox" value="Newsletter" /> Newsletter</label>
            <label><input name="subscribe" type="checkbox" value="Product Updates" /> Product Updates</label>
          </div>
        </div>
        <div class="full-width">
          <button class="btn-primary" type="submit">Save</button>
        </div>
      </form>
    </section>

    <section>
      <h2>User Table</h2>
      <div id="admin-delete-error" style="color: red; display: none; margin-bottom: 0.5rem"></div>
      <table id="user-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Role</th>
            <th>Age</th>
            <th>Email</th>
            <th>Gender</th>
            <th>Subscription</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <div class="modal" id="confirm-modal">
      <div class="modal-content">
        <p>Are you sure you want to delete this user?</p>
        <button class="btn-danger" id="confirm-delete">Yes</button>
        <button class="btn-secondary" id="cancel-delete">Cancel</button>
      </div>
    </div>
    
    <script>
      let isAdmin = false;
      let editRow = null;
      let rowToDelete = null;

      document.getElementById("admin-login-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("admin-email").value;
        const password = document.getElementById("admin-password").value;
        const status = document.getElementById("login-status");
        if (email === "admin@example.com" && password === "admin123") {
          const deleteErrorBox = document.getElementById("admin-delete-error");
          deleteErrorBox.textContent = "";
          deleteErrorBox.style.display = "none";
          isAdmin = true;
          status.style.display = "none";
          document.getElementById("admin-email").value = "";
          document.getElementById("admin-password").value = "";
        } else {
          status.style.display = "block";
        }
      });

      document.getElementById("user-form").addEventListener("submit", (e) => {
        e.preventDefault();

        const errors = [];
        const formErrors = document.getElementById("form-errors");
        formErrors.style.display = "none";
        formErrors.innerHTML = "";

        // Basic input values
        const nameVal = nameInput.value.trim();
        const roleVal = roleInput.value;
        const ageVal = ageInput.value.trim();
        const emailVal = emailInput.value.trim();
        const genderVal = document.querySelector('input[name="gender"]:checked');
        const subs =
          Array.from(document.querySelectorAll('input[name="subscribe"]:checked'))
            .map((cb) => cb.value)
            .join(", ") || "None";

        // Clear previous error states
        [nameInput, roleInput, ageInput, emailInput].forEach((input) => input.classList.remove("error-input"));

        // Validation rules
        if (!nameVal || !/^[a-zA-Z]{1,20}$/.test(nameVal)) {
          errors.push("Name must be 1–20 letters only (no spaces or symbols).");
          nameInput.classList.add("error-input");
        }
        if (!roleVal) {
          errors.push("Role is required.");
          roleInput.classList.add("error-input");
        }
        if (!ageVal || isNaN(ageVal) || ageVal < 1 || ageVal > 99) {
          errors.push("Age must be between 1 and 99.");
          ageInput.classList.add("error-input");
        }
        if (!emailVal || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) {
          errors.push("Valid email is required.");
          emailInput.classList.add("error-input");
        }
        if (!genderVal) {
          errors.push("Gender selection is required.");
        }

        if (errors.length > 0) {
          formErrors.innerHTML = "<ul><li>" + errors.join("</li><li>") + "</li></ul>";
          formErrors.style.display = "block";
          return;
        }

        e.preventDefault();
        const name = nameInput.value.trim();
        const role = roleInput.value;
        const age = ageInput.value;
        const email = emailInput.value.trim();
        const gender = document.querySelector('input[name="gender"]:checked')?.value;
        const subscriptions =
          Array.from(document.querySelectorAll('input[name="subscribe"]:checked'))
            .map((cb) => cb.value)
            .join(", ") || "None";

        if (editRow) {
          editRow.innerHTML = generateRowHTML(name, role, age, email, gender, subscriptions, editRow.children[6].textContent);
          editRow = null;
          document.getElementById("form-title").textContent = "Add New User";
        } else {
          const row = document.createElement("tr");
          row.innerHTML = generateRowHTML(name, role, age, email, gender, subscriptions, "Active");
          tableBody.appendChild(row);
        }
        form.reset();
      });

      function generateRowHTML(name, role, age, email, gender, subscriptions, status) {
        return `<td>${name}</td><td>${role}</td><td>${age}</td><td>${email}</td><td>${gender}</td><td>${subscriptions}</td><td>${status}</td>
      <td>
        <button class="btn-secondary edit-btn">Edit</button>
        <button class="btn-danger delete-btn">Delete</button>
        <button class="btn-primary status-btn">${status === "Active" ? "Deactivate" : "Activate"}</button>
      </td>`;
      }

      const tableBody = document.querySelector("#user-table tbody");
      const form = document.getElementById("user-form");
      const nameInput = document.getElementById("name");
      const roleInput = document.getElementById("role");
      const ageInput = document.getElementById("age");
      const emailInput = document.getElementById("email");

      tableBody.addEventListener("click", function (e) {
        const row = e.target.closest("tr");
        if (e.target.classList.contains("edit-btn")) {
          editRow = row;
          document.getElementById("form-title").textContent = "Edit User";
          nameInput.value = row.children[0].textContent;
          roleInput.value = row.children[1].textContent;
          ageInput.value = row.children[2].textContent;
          emailInput.value = row.children[3].textContent;
          form.querySelectorAll('input[name="gender"]').forEach((r) => (r.checked = r.value === row.children[4].textContent));
          const subs = row.children[5].textContent.split(", ").map((s) => s.trim());
          form.querySelectorAll('input[name="subscribe"]').forEach((cb) => (cb.checked = subs.includes(cb.value)));
        } else if (e.target.classList.contains("delete-btn")) {
          if (!isAdmin && row.children[1].textContent === "Admin") {
            const errorBox = document.getElementById("admin-delete-error");
            errorBox.textContent = "Admin login required to delete Admin-level users.";
            errorBox.style.display = "block";

            return;
          }
          rowToDelete = row;
          document.getElementById("confirm-modal").style.display = "flex";
        } else if (e.target.classList.contains("status-btn")) {
          const cell = row.children[6];
          cell.textContent = cell.textContent === "Active" ? "Inactive" : "Active";
          e.target.textContent = cell.textContent === "Active" ? "Deactivate" : "Activate";
        }
      });

      document.getElementById("confirm-delete").addEventListener("click", () => {
        if (rowToDelete) rowToDelete.remove();
        document.getElementById("confirm-modal").style.display = "none";
      });
      document.getElementById("cancel-delete").addEventListener("click", () => {
        document.getElementById("confirm-modal").style.display = "none";
      });

      // Admin logout functionality
      document.getElementById("logout-btn").addEventListener("click", () => {
        isAdmin = false;
        document.getElementById("admin-controls").style.display = "none";
        alert("Logged out as admin.");
      });

      // Show logout controls when logged in
      document.getElementById("admin-login-form").addEventListener("submit", () => {
        if (isAdmin) {
          document.getElementById("admin-controls").style.display = "block";
        }
      });

      // Add default users on load
      const defaultUsers = [
        {
          name: "Alice",
          role: "Admin",
          age: 30,
          email: "alice@site.com",
          gender: "Female",
          subscriptions: "Newsletter",
          status: "Active",
        },
        {
          name: "Bob",
          role: "Viewer",
          age: 25,
          email: "bob@site.com",
          gender: "Male",
          subscriptions: "Product Updates",
          status: "Inactive",
        },
        {
          name: "Eve",
          role: "Editor",
          age: 28,
          email: "eve@site.com",
          gender: "Other",
          subscriptions: "Newsletter, Product Updates",
          status: "Active",
        },
      ];

      defaultUsers.forEach((u) => {
        const row = document.createElement("tr");
        row.innerHTML = generateRowHTML(u.name, u.role, u.age, u.email, u.gender, u.subscriptions, u.status);
        tableBody.appendChild(row);
      });
    </script>
  </body>
</html>
